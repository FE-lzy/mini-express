(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-931d9a8e"],{"1f1d":function(e,t,o){"use strict";var l=o("7e3e"),r=o.n(l);r.a},"7e3e":function(e,t,o){},"975a":function(e,t,o){e.exports=o.p+"static/img/scan1.d549ec98.png"},d41b:function(e,t,o){"use strict";o.r(t);var l=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("el-row",{attrs:{gutter:20}},[l("el-col",{attrs:{span:12}},[l("div",{staticClass:"grid-content"},[l("h3",{staticStyle:{"text-align":"center"}},[e._v("扫描录入")]),e._v(" "),l("h4",{staticStyle:{"text-align":"center"}},[e._v("(请确保扫描设备已连接到我的电脑)")]),e._v(" "),l("div",{staticStyle:{display:"flex","justify-content":"center"}},[l("el-input",{ref:"scanStr",staticStyle:{"text-align":"center"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请使用扫描设备扫描发票二维码，扫描过程请保持输入框聚焦状态"},on:{input:e.changeT},model:{value:e.scanStr,callback:function(t){e.scanStr=t},expression:"scanStr"}})],1),e._v(" "),l("h5"),e._v(" "),l("img",{staticStyle:{width:"100%"},attrs:{src:o("975a")}})])]),e._v(" "),l("el-col",{attrs:{span:12}},[l("div",{staticClass:"grid-content"},[l("h2",{staticClass:"title"},[e._v("手动输入")]),e._v(" "),l("el-form",{ref:"validForm",staticClass:"demo-ruleForm form-div",attrs:{model:e.ruleForm,"status-icon":"","label-width":"120px"}},[l("el-form-item",{attrs:{label:"发票代码",prop:"invoiceCode",rules:[{required:!0,message:"请输入",trigger:"blur"}]}},[l("el-input",{attrs:{type:"text",placeholder:"输入发票代码"},model:{value:e.ruleForm.invoiceCode,callback:function(t){e.$set(e.ruleForm,"invoiceCode",t)},expression:"ruleForm.invoiceCode"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"发票号码",prop:"invoiceNumber",rules:[{required:!0,message:"请输入",trigger:"blur"}]}},[l("el-input",{attrs:{type:"text",placeholder:"输入发票号码"},model:{value:e.ruleForm.invoiceNumber,callback:function(t){e.$set(e.ruleForm,"invoiceNumber",t)},expression:"ruleForm.invoiceNumber"}})],1),e._v(" "),l("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"开票日期",prop:"billTime",rules:[{required:!0,message:"请输入",trigger:"blur"}]}},[l("el-date-picker",{attrs:{type:"date",placeholder:"选择开票日期","value-format":"yyyy-MM-dd"},model:{value:e.ruleForm.billTime,callback:function(t){e.$set(e.ruleForm,"billTime",t)},expression:"ruleForm.billTime"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"校验码后六位",rules:[{required:!0,message:"请输入",trigger:"blur"}]}},[l("el-input",{attrs:{placeholder:"输入校验码后六位"},model:{value:e.ruleForm.checkCode,callback:function(t){e.$set(e.ruleForm,"checkCode",t)},expression:"ruleForm.checkCode"}})],1),e._v(" "),l("el-form-item",[l("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:function(t){return e.submitForm("validForm")}}},[e._v("查验")])],1)],1)],1)])],1)],1)},r=[],n=(o("28a5"),o("2934")),a={dwbm:localStorage.getItem("dwbm")},i={name:"Scan",data:function(){return{ruleForm:{invoiceCode:"037001851107",invoiceNumber:"01947559",billTime:"2019-10-4",invoiceAmount:"",checkCode:"250185"},fullscreenLoading:!1,beginInter:!0,scanStr:"",billType:"",billOptions:[{value:"1",label:"普通发票/增值税电子发票/卷式普通发票/电子普通[通行费]发票"},{value:"2",label:"xx增值税(机动车/二手车销售发票),专用发票"}]}},mounted:function(){this.$refs.scanStr.focus()},methods:{changeT:function(e){console.log(e,this.beginInter),this.scanStr=e;var t=this;this.beginInter&&(this.beginInter=!1,this.fullscreenLoading=!0,setTimeout((function(){t.beginInter=!0,t.fullscreenLoading=!1,t.scanQuery()}),600))},fetchIsHave:function(e){var t=this;console.log(e);var o="scan"==e?this.scanStr.split(",")[3]:this.ruleForm.invoiceNumber;console.log(o),Object(n["a"])("/bill/getBillInfo",{code:o},"POST").then((function(o){console.log(o),0==o.code?t.choiceModel(JSON.parse(o.data.fp_detail.fp_detail).invoiceTypeCode,o.data,!0):"scan"==e?t.queryByScan():t.queryByCode()}))},getBillType:function(e){this.billType=e},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;console.log("----------",t.fullscreenLoading),t.fullscreenLoading=!0,t.fetchIsHave("code")}))},queryByCode:function(){var e=this,t=localStorage.getItem("lsToken"),o=Object.assign(this.ruleForm,a,{token:t});console.log("请求参数",o);var l=this;Object(n["a"])("/bill/queryBillByCode",o,"post").then((function(t){-1==t.code&&"token error"==t.data.error&&(console.log("出错"),Object(n["a"])("/bill/getToken",{},"POST").then((function(t){console.log(t),localStorage.removeItem("lsToken"),localStorage.setItem("lsToken",t.message),e.queryByCode()}))),0==t.code?l.choiceModel(JSON.parse(t.data.invoiceResult).invoiceTypeCode,t.data.invoiceResult,!1):(console.log(t.message),l.fullscreenLoading=!1,l.$message.error(t.message))})).catch((function(e){l.fullscreenLoading=!1,l.$message.error(e)}))},scanQuery:function(){this.scanStr&&this.fetchIsHave("scan")},queryByScan:function(){var e=this,t={scanStr:this.scanStr,token:localStorage.getItem("lsToken")};console.log("123"),Object(n["a"])("/bill/queryBillByScan",t,"post").then((function(t){console.log(t),"token error"==t.data.error&&Object(n["a"])("/user/getLsToken",{},"POST").then((function(t){localStorage.removeItem("lsToken"),localStorage.setItem("lsToken",t),e.queryByCode()})),0==t.code&&"1000"==t.data.resultCode?e.choiceModel(JSON.parse(t.data.invoiceResult).invoiceTypeCode,t.data.invoiceResult,!1):(e.fullscreenLoading=!1,e.$message.error(t.message))}))},choiceModel:function(e,t,o){console.log("----------",this.fullscreenLoading),this.fullscreenLoading=!1,"01"==e||"04"==e||"10"==e?this.$router.push({name:"普通发票结果",params:{type:"scan",scanStr:t,isHave:o}}):"11"==e?this.$router.push({name:"卷式发票结果",params:{type:"scan",scanStr:t,isHave:o}}):"14"==e?this.$router.push({name:"通行证发票结果",params:{type:"scan",scanStr:t,isHave:o}}):this.$message.warning("目前仅支持查验普通发票/增值税电子发票/卷式普通发票/电子普通[通行费]发票")}}},s=i,c=(o("1f1d"),o("2877")),u=Object(c["a"])(s,l,r,!1,null,"ef907dee",null);t["default"]=u.exports}}]);